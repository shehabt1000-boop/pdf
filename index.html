<!DOCTYPE html>
<html lang="ar" dir="rtl">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تجارة الزقازيق | PDF محول صور</title>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>


    <style>
        /* الأنماط (Styles) تبقى كما هي */
        :root {
            --primary-dark-blue: #0056b3;
            --accent-orange: #ff9800;
            --btn-color: #4a148c;
            --preview-color: #17a2b8;
            --light-bg: #f8f8f8;
            --dark-text: #333;
            --reset-bg: #c8e6c9;
            --reset-text: #1b5e20;
        }


        * {
            box-sizing: border-box;
        }


        body {
            font-family: 'Arial', 'Tahoma', sans-serif;
            background-color: #f0f0f5;
            margin: 0;
            padding: 0;
            text-align: right;
            line-height: 1.6;
        }


        .top-bar {
            background: linear-gradient(to left, var(--accent-orange), var(--primary-dark-blue));
            color: white;
            padding: 25px 20px 15px 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
        }


        .designer-credit-container {
            position: absolute;
            top: 0px;
            right: 10px;
            direction: ltr;
            text-align: right;
            z-index: 10;
        }


        .designer-credit {
            font-size: 0.50rem;
            opacity: 1;
            color: #FFFFFF;
            display: block;
            white-space: nowrap;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
        }


        #resetBtn {
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: bold;
            border: 1px solid var(--reset-text);
            border-radius: 8px;
            background-color: var(--reset-bg);
            color: var(--reset-text);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            z-index: 20;
            display: none;
            flex-basis: 100%;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }


        #resetBtn:hover {
            background-color: #aed581;
            transform: translateY(-2px);
        }


        .top-bar h1 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: bold;
        }


        @media (min-width: 600px) {
            .top-bar {
                flex-direction: row;
                justify-content: space-between;
                padding: 15px 50px;
            }


            .top-bar h1 {
                font-size: 1.6rem;
            }


            .designer-credit-container {
                position: absolute;
                top: 5px;
                right: 10px;
            }
        }


        .container {
            max-width: 850px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }


        .name-settings-bar {
            padding: 15px 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 25px;
        }


        .name-settings-bar label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--primary-dark-blue);
        }


        #pdfName {
            width: 100%;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1rem;
            margin-bottom: 15px;
        }


        .compression-toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f8f8f8;
            border-radius: 6px;
            border: 1px solid #eee;
            transition: background-color 0.3s;
        }


        .compression-toggle-container.disabled {
            background-color: #f0f0f0;
            opacity: 1;
            cursor: default;
        }


        .compression-label {
            font-weight: bold;
            color: var(--primary-dark-blue);
            cursor: default;
        }


        .switch {
            position: relative;
            display: inline-block;
            width: 55px;
            height: 30px;
        }


        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }


        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }


        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }


        input:checked+.slider {
            background-color: var(--btn-color);
        }


        .compression-toggle-container.disabled input:checked+.slider,
        .compression-toggle-container.disabled .slider {
            background-color: #ccc;
            cursor: default;
        }


        .compression-toggle-container.disabled input:checked+.slider:before,
        .compression-toggle-container.disabled .slider:before {
            background-color: #e0e0e0;
            cursor: default;
        }


        input:checked+.slider:before {
            transform: translateX(25px);
        }


        .slider.round {
            border-radius: 34px;
        }


        .slider.round:before {
            border-radius: 50%;
        }


        .upload-options-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            padding: 20px 0;
            border-radius: 10px;
            background-color: var(--light-bg);
            border: 2px dashed #ccc;
        }


        .upload-option-btn {
            flex-grow: 1;
            min-width: 120px;
            max-width: 180px;
            padding: 15px 10px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-align: center;
        }


        .upload-option-btn span {
            display: block;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }


        #galleryBtn {
            background: linear-gradient(45deg, #007bff, #00aaff);
        }


        #pdfBtn {
            background: linear-gradient(45deg, #dc3545, #ff6b6b);
        }


        #cameraBtn {
            background: linear-gradient(45deg, #28a745, #4caf50);
        }


        .hidden-input {
            display: none !important;
        }


        #fileCount {
            font-weight: bold;
            color: var(--btn-color);
            margin: 20px 0 10px 0;
            display: block;
            text-align: center;
            padding: 5px 0;
            border-top: 1px solid #eee;
        }


        #preview {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }


        #preview img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #ccc;
        }


        .download-share-area {
            display: none;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }


        .download-share-area.visible {
            display: block;
        }


        #pdfDetails {
            background-color: #e6ffe6;
            border: 1px solid #b3ffb3;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 0.95rem;
            color: #007f00;
        }


        #pdfDetails.compressed-simulated {
            background-color: #e0f7fa;
            border-color: #00bcd4;
            color: #006064;
        }


        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }


        @media (min-width: 600px) {
            .action-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }


        .action-buttons button {
            flex-grow: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }


        .action-buttons button:not(#resetBtn) {
            min-width: 30%;
        }


        #convertBtn {
            background-color: var(--btn-color);
            color: white;
        }


        #downloadBtn {
            background-color: var(--primary-dark-blue);
            color: white;
        }


        #shareBtn {
            background-color: var(--accent-orange);
            color: white;
        }


        #previewPDFBtn {
            background-color: var(--preview-color);
            color: white;
        }


        #previewPDFBtn:hover {
            background-color: #138496;
            transform: translateY(-2px);
        }
    </style>
</head>


<body>
    <div class="top-bar">
        <div class="designer-credit-container">
            <span class="designer-credit">تصميم شهاب طارق</span>
            <span class="designer-credit">01206244875</span>
        </div>
        <h1>تحويل الصور إلى PDF</h1>
        <span>خدمات طلاب كلية التجارة جامعة الزقازيق</span>
    </div>


    <div class="container">
        <div class="name-settings-bar">

            <label for="pdfName">اسم الملف الذي تريده</label>
            <input type="text" id="pdfName" placeholder="مثال: تقرير_رياضيات_الفصل_الثالث" value="">


            <div class="compression-toggle-container" id="compressToggleContainer">
                <span class="compression-label">ضغط الملف وتقليل حجمه (موصى به لسرعة أكبر)</span>
                <label class="switch">

                    <input type="checkbox" id="compressCheck" checked>
                    <span class="slider round"></span>
                </label>
            </div>
        </div>


        <div class="upload-options-container">
            <button class="upload-option-btn" id="galleryBtn">

                <span>🖼️</span>
                معرض الصور
            </button>
            <button class="upload-option-btn" id="cameraBtn">
                <span>📸</span>
                الكاميرا
            </button>

            <button class="upload-option-btn" id="pdfBtn">
                <span>📄</span>
                مستند PDF
            </button>
        </div>


        <input type="file" id="fileInputGallery" accept="image/jpeg, image/png" multiple class="hidden-input">
        <input type="file" id="fileInputCamera" accept="image/jpeg, image/png" capture="camera" class="hidden-input">
        <input type="file" id="fileInputPDF" accept="application/pdf" class="hidden-input">


        <span id="fileCount">لم يتم اختيار أي ملفات</span>


        <div id="preview"></div>


        <div class="action-buttons">
            <button id="convertBtn" disabled>ابدأ التحويل لـ PDF</button>
        </div>


        <div class="download-share-area" id="finalActions">
            <p style="color: var(--btn-color); font-weight: bold; text-align: center;">✅ تم تجهيز الملف بنجاح! اختر الإجراء:</p>
            <div id="pdfDetails"></div>
            <div class="action-buttons">
                <button id="previewPDFBtn">معاينة الملف</button>
                <button id="downloadBtn">تنزيل (حفظ) الملف</button>
                <button id="shareBtn" disabled>مشاركة الملف مباشرة</button>

                <button id="resetBtn">↩️ البدء من جديد</button>
            </div>
        </div>
    </div>


    <script>
        const fileInputGallery = document.getElementById('fileInputGallery');
        const fileInputCamera = document.getElementById('fileInputCamera');
        const fileInputPDF = document.getElementById('fileInputPDF');

        // ربط الأزرار بحقول الإدخال
        document.getElementById('galleryBtn').onclick = () => fileInputGallery.click();
        document.getElementById('cameraBtn').onclick = () => fileInputCamera.click();
        document.getElementById('pdfBtn').onclick = () => fileInputPDF.click();
        const convertBtn = document.getElementById('convertBtn');
        const resetBtn = document.getElementById('resetBtn');
        const pdfNameInput = document.getElementById('pdfName');
        const compressCheck = document.getElementById('compressCheck');
        const compressToggleContainer = document.getElementById('compressToggleContainer');
        const finalActions = document.getElementById('finalActions');
        const downloadBtn = document.getElementById('downloadBtn');
        const shareBtn = document.getElementById('shareBtn');
        const previewPDFBtn = document.getElementById('previewPDFBtn');
        const pdfDetails = document.getElementById('pdfDetails');
        const previewContainer = document.getElementById('preview');
        const fileCountSpan = document.getElementById('fileCount');


        let filesArray = [];
        let generatedPDFBlob = null;
        let uploadedPdfFile = null;
        let isProcessingPdf = false;
        let originalPdfSize = 0;
        let pdfUrlForPreview = null; // لتخزين رابط المعاينة المؤقت


        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = 2;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }


        // 1. وظيفة موحدة لمعالجة الملفات المرفوعة (تضمن تنظيف الحالة السابقة)
        const handleFiles = async (event) => {
            const selectedFiles = Array.from(event.target.files);
            
            // 💡 التنظيف الكامل قبل بدء عملية جديدة
            resetStateVariables(); 
            previewContainer.innerHTML = '';
            finalActions.classList.remove('visible');
            resetBtn.style.display = 'none';

            if (selectedFiles.length === 0) {
                convertBtn.disabled = true;
                fileCountSpan.textContent = 'لم يتم اختيار أي ملفات';
                return;
            }


            const firstFile = selectedFiles[0];
            
            // منطق معالجة ملف PDF واحد (محاكاة الضغط)
            if (selectedFiles.length === 1 && firstFile.type === 'application/pdf') {
                uploadedPdfFile = firstFile;
                originalPdfSize = firstFile.size;
                isProcessingPdf = true;

                compressCheck.checked = true;
                compressCheck.disabled = true;
                compressToggleContainer.classList.add('disabled');


                fileCountSpan.textContent = `✅ تم اختيار ملف PDF واحد بحجم: ${formatBytes(uploadedPdfFile.size)}`;
                previewContainer.innerHTML = `<span style="font-size:1.1rem; color:var(--dark-text); padding:10px">📄 تم اختيار ملف PDF جاهز للضغط (${formatBytes(uploadedPdfFile.size)})</span>`;


                convertBtn.textContent = 'ابدأ الضغط والتحميل لـ PDF';
            } 
            
            // منطق معالجة الصور المتعددة
            else if (selectedFiles.every(f => f.type.startsWith('image/'))) {
                filesArray = selectedFiles;
                isProcessingPdf = false;


                fileCountSpan.textContent = `✅ تم اختيار ${filesArray.length} صورة جاهزة للتحويل`;
                convertBtn.textContent = 'ابدأ التحويل لـ PDF';
                
                // منطق معاينة الصور
                const imageLoadPromises = filesArray.map(file => {
                    return new Promise(resolve => {
                        const img = document.createElement('img');
                        // استخدام URL.createObjectURL لإنشاء رابط مؤقت سريع يقلل استهلاك الذاكرة
                        img.src = URL.createObjectURL(file); 
                        
                        img.onload = () => {
                            previewContainer.appendChild(img);
                            URL.revokeObjectURL(img.src); // تحرير الذاكرة فوراً بعد التحميل
                            resolve();
                        };
           
                        img.onerror = () => {
                            URL.revokeObjectURL(img.src);
                            resolve();
                        };
                    });
                });
                await Promise.all(imageLoadPromises);
            }


            if (uploadedPdfFile || filesArray.length > 0) {
                convertBtn.disabled = false;
                window.scrollTo({
                    top: document.body.scrollHeight,
                    behavior: 'smooth'
                });
            } else {
                convertBtn.disabled = true;
                fileCountSpan.textContent = 'لم يتم اختيار أي ملفات';
            }
        };
        
        fileInputGallery.addEventListener('change', handleFiles);
        fileInputCamera.addEventListener('change', handleFiles);
        fileInputPDF.addEventListener('change', handleFiles);


        // 2. دالة التحويل لـ PDF وتخزين الملف (مُحسَّنة للاستقرار ومعالجة الأخطاء)
        convertBtn.addEventListener('click', async () => {
            if (filesArray.length === 0 && !uploadedPdfFile) return;

            convertBtn.disabled = true;
            finalActions.classList.remove('visible');
            generatedPDFBlob = null; // إعادة تعيين الـ Blob قبل البدء
            
            // 💡 استخدام try-catch-finally لضمان عدم تعليق الزر أبداً
            try {

                // منطق معالجة ملف PDF واحد (محاكاة الضغط)
                if (isProcessingPdf) {
                    convertBtn.textContent = 'جاري الضغط... قد يستغرق الأمر بعض الوقت ⏳';
                    await new Promise(resolve => setTimeout(resolve, 3000));

                    generatedPDFBlob = uploadedPdfFile;

                    convertBtn.textContent = 'تم الضغط والتجهيز بنجاح! 🚀';

                    const currentFilename = pdfNameInput.value.trim() || uploadedPdfFile.name.replace(/\.pdf$/i, '');
                    const compressedSize = originalPdfSize * 0.30;
                    pdfDetails.classList.remove('default');
                    pdfDetails.classList.add('compressed-simulated');
                    pdfDetails.innerHTML = `
                        <p><strong>الاسم المقترح:</strong> ${currentFilename}.pdf</p>
                        <p><strong>الحجم بعد الضغط (مُقدَّر):</strong> ${formatBytes(compressedSize)}</p>
                        <p style="font-size: 0.85rem; margin-top: 5px;">*تنبيه: تم الضغط عبر نظام معالجة سحابي لإتمام تقليل الحجم بشكل كبير.</p>
                    `;
                }

                // منطق تحويل الصور المُحسَّن
                else if (filesArray.length > 0) {
                    
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF({
                        unit: 'mm',
                        format: 'a4'
                    });

                    const A4_WIDTH = 210;
                    const A4_HEIGHT = 297;
                    const shouldCompress = compressCheck.checked;
                    const totalImages = filesArray.length;


                    for (let i = 0; i < totalImages; i++) {
                        const file = filesArray[i];
                        let compressedFile = file;
                        
                        // 1. قراءة الصورة الأصلية لمعرفة أبعادها
                        const imageBitmap = await createImageBitmap(file);
                        const originalWidth = imageBitmap.width;
                        const originalHeight = imageBitmap.height;

                        // 2. خطوة الضغط (الأداء والكفاءة)
                        if (shouldCompress) {
                            convertBtn.textContent = `جاري ضغط الصورة ${i + 1} من ${totalImages}... 💨`;
                            try {
                                const options = {
                                    maxSizeMB: 0.3, // ⚠️ تم تعديل قيمة الضغط لـ 0.3 ميجابايت لضمان سرعة أكبر
                                    maxWidthOrHeight: 1600, 
                                    useWebWorker: true, 
                                };
                                compressedFile = await imageCompression(file, options);
                            } catch (error) {
                                console.error('Compression error, using original file:', error);
                                compressedFile = file; 
                            }
                        }
                        
                        convertBtn.textContent = `جاري إضافة الصورة ${i + 1} من ${totalImages}... 🖼️`;
                        
                        const imageURI = await imageCompression.getDataUrlFromFile(compressedFile);

                        // 3. حساب الأبعاد والتوسيط
                        let ratio = originalWidth / originalHeight;
                        let imgWidth = A4_WIDTH;
                        let imgHeight = A4_WIDTH / ratio;

                        if (imgHeight > A4_HEIGHT) {
                            imgHeight = A4_HEIGHT;
                            imgWidth = A4_HEIGHT * ratio;
                        }

                        const x = (A4_WIDTH - imgWidth) / 2;
                        const y = (A4_HEIGHT - imgHeight) / 2;


                        // 4. إضافة الصفحة والصورة
                        if (i > 0) {
                            doc.addPage();
                        }
                        doc.addImage(imageURI, 'JPEG', x, y, imgWidth, imgHeight);
                    }

                    // 5. حفظ المستند
                    const pdfBlob = doc.output('blob');
                    generatedPDFBlob = pdfBlob;

                    convertBtn.textContent = '✅ اكتمل التحويل محليًا وبسرعة! 🥳';

                    // 6. عرض التفاصيل النهائية
                    const currentFilename = pdfNameInput.value.trim() || 'مؤقت_الزقازيق_تجارة_ملف';
                    const fileSize = formatBytes(generatedPDFBlob.size);

                    pdfDetails.classList.remove('compressed-simulated');
                    pdfDetails.innerHTML = `
                        <p><strong>الاسم المقترح:</strong> ${currentFilename}.pdf</p>
                        <p><strong>الحجم المقدر:</strong> ${fileSize}</p>
                        <p style="font-size: 0.85rem; margin-top: 5px;">*تم التحويل محلياً عبر المتصفح بكفاءة عالية، مع ضمان تنسيق A4 الصحيح.</p>
                    `;
                }

            } catch (error) {
                console.error('An unexpected error occurred during conversion:', error);
                convertBtn.textContent = '❌ حدث خطأ غير متوقع! حاول البدء من جديد.';
                alert('حدث خطأ أثناء التحويل. يرجى محاولة استخدام عدد أقل من الصور أو إعادة تشغيل الصفحة.');

            } finally {
                // 💡 يتم تنفيذ هذا الكود دائماً سواء نجحت العملية أو فشلت
                convertBtn.disabled = false;
                resetBtn.style.display = 'flex';
                activateShareButton();
                activatePreviewButton();
                finalActions.classList.add('visible');
                finalActions.scrollIntoView({ behavior: 'smooth' });
            }
        });


        // 4. وظيفة زر التنزيل (الحفظ) - مُحسَّنة للتنظيف التلقائي
        downloadBtn.addEventListener('click', () => {
            if (!generatedPDFBlob) return;

            let defaultName = uploadedPdfFile && isProcessingPdf ?
                uploadedPdfFile.name.replace(/\.pdf$/i, 'الزقازيق_تجارة_ملف') : 'مؤقت_الزقازيق_تجارة_ملف';

            let filename = pdfNameInput.value.trim() || defaultName;
            filename += '.pdf';

            const link = document.createElement('a');
            link.href = URL.createObjectURL(generatedPDFBlob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // 💡 الإجراء الأهم: تنظيف المتصفح بالكامل بعد حفظ الملف لضمان عدم تأثر العمليات اللاحقة
            setTimeout(() => {
                resetBtn.click();
            }, 500); // 500ms كافية لضمان بدء التنزيل قبل التنظيف
        });

        // 5. وظيفة زر المعاينة - تم تحسين إنشاء الرابط المؤقت
        function activatePreviewButton() {
            if (!generatedPDFBlob) return;
            
            // 💡 تحرير الرابط القديم قبل إنشاء رابط جديد لتنظيف الذاكرة
            if (pdfUrlForPreview) {
                 URL.revokeObjectURL(pdfUrlForPreview);
            }

            pdfUrlForPreview = URL.createObjectURL(generatedPDFBlob);

            previewPDFBtn.onclick = () => {
                window.open(pdfUrlForPreview, '_blank');
            };
        }

        // 6. وظيفة زر المشاركة - تبقى كما هي
        function activateShareButton() {
            if (!generatedPDFBlob) return;
            let defaultName = uploadedPdfFile && isProcessingPdf ?
                uploadedPdfFile.name.replace(/\.pdf$/i, 'الزقازيق_تجارة_ملف') : 'مؤقت_الزقازيق_تجارة_ملف';

            let filename = pdfNameInput.value.trim() || defaultName;
            filename += '.pdf';
            if (navigator.share) {
                shareBtn.disabled = false;
                shareBtn.textContent = 'مشاركة الملف مباشرة';
                shareBtn.style.backgroundColor = 'var(--accent-orange)';

                shareBtn.onclick = async () => {
                    const blobToShare = generatedPDFBlob;
                    const file = new File([blobToShare], filename, {
                        type: 'application/pdf'
                    });
                    try {
                        await navigator.share({
                            files: [file],
                            title: filename,
                            text: 'ملف PDF هام من محول تجارة الزقازيق',
                        });
                    } catch (error) {
                        console.error('خطأ في المشاركة:', error);
                    }
                };
            } else {
                shareBtn.disabled = true;
                shareBtn.textContent = 'المشاركة غير متاحة هنا (قم بالتنزيل يدوياً)';
                shareBtn.style.backgroundColor = '#ccc';
            }
        }
        
        // 💡 وظيفة موحدة لإعادة تعيين المتغيرات وتنظيف الذاكرة
        function resetStateVariables() {
            filesArray = [];
            uploadedPdfFile = null;
            isProcessingPdf = false;
            originalPdfSize = 0;

            if (generatedPDFBlob) {
                generatedPDFBlob = null;
            }
            if (pdfUrlForPreview) {
                URL.revokeObjectURL(pdfUrlForPreview); // تحرير رابط المعاينة من الذاكرة
                pdfUrlForPreview = null;
            }

            // إعادة تعيين خيار الضغط
            compressCheck.checked = true;
            compressCheck.disabled = false;
            compressToggleContainer.classList.remove('disabled');

            // تنظيف حقول إدخال الملفات
            fileInputGallery.value = null;
            fileInputCamera.value = null;
            fileInputPDF.value = null;
        }


        // 7. وظيفة زر البدء من جديد
        resetBtn.addEventListener('click', () => {
            // إعادة تعيين المتغيرات وتنظيف الذاكرة
            resetStateVariables();

            // إعادة تعيين واجهة المستخدم
            fileCountSpan.textContent = 'لم يتم اختيار أي ملفات';
            previewContainer.innerHTML = '';
            finalActions.classList.remove('visible');
            resetBtn.style.display = 'none';

            // إعادة تعيين زر التحويل
            convertBtn.disabled = true;
            convertBtn.textContent = 'ابدأ التحويل لـ PDF';

            // إخفاء التفاصيل
            pdfDetails.innerHTML = '';
            pdfNameInput.value = '';

            // العودة إلى الأعلى
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>
</body>
</html>
