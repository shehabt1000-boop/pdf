<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚ | PDF Ù…Ø­ÙˆÙ„ ØµÙˆØ±</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>

    <style>
        /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        :root {
            --primary-dark-blue: #0056b3;
            --accent-orange: #ff9800;
            --btn-color: #4a148c;
            --preview-color: #17a2b8;
            --light-bg: #f8f8f8;
            --dark-text: #333;
            --reset-bg: #c8e6c9;
            --reset-text: #1b5e20;
        }

        /* Ø§Ù„Ø£Ø³Ø§Ø³ ÙˆØ§Ù„ØªØ¬Ø§ÙˆØ¨ÙŠØ© (Reset and Responsiveness) */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Tahoma', sans-serif;
            background-color: #f0f0f5;
            margin: 0;
            padding: 0;
            text-align: right;
            line-height: 1.6;
        }

        /* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar {
            background: linear-gradient(to left, var(--accent-orange), var(--primary-dark-blue));
            color: white;
            padding: 25px 20px 15px 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ø³Ù… Ø§Ù„Ù…ØµÙ…Ù… */
        .designer-credit-container {
            position: absolute;
            top: 0px;
            right: 10px;
            direction: ltr;
            text-align: right;
            z-index: 10;
        }

        .designer-credit {
            font-size: 0.50rem;
            opacity: 1;
            color: #FFFFFF;
            display: block;
            white-space: nowrap;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
        }

        /* Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ - ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ù…ÙˆÙ‚Ø¹Ù‡ Ø§Ù„Ù…Ø·Ù„Ù‚ ÙˆØªÙ†Ø³ÙŠÙ‚Ù‡ Ù„ÙŠØªÙ„Ø§Ø¡Ù… Ù…Ø¹ Ø§Ù„Ù€ action-buttons */
        #resetBtn {
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: bold;
            border: 1px solid var(--reset-text);
            border-radius: 8px;
            background-color: var(--reset-bg);
            color: var(--reset-text);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            z-index: 20;
            display: none;
            /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø²Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ action-buttons Ù„ÙŠØ£Ø®Ø° Ø³Ø·Ø± ÙƒØ§Ù…Ù„ ÙˆÙŠÙØµÙ„ Ø¹Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰ */
            flex-basis: 100%;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        #resetBtn:hover {
            background-color: #aed581;
            transform: translateY(-2px);
        }

        .top-bar h1 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: bold;
        }

        @media (min-width: 600px) {
            .top-bar {
                flex-direction: row;
                justify-content: space-between;
                padding: 15px 50px;
            }

            .top-bar h1 {
                font-size: 1.6rem;
            }

            .designer-credit-container {
                position: absolute;
                top: 5px;
                right: 10px;
            }
        }

        .container {
            max-width: 850px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }

        /* Ø´Ø±ÙŠØ· ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù„Ù ÙˆØ®ÙŠØ§Ø± Ø§Ù„Ø¶ØºØ· */
        .name-settings-bar {
            padding: 15px 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 25px;
        }

        .name-settings-bar label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--primary-dark-blue);
        }

        #pdfName {
            width: 100%;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ (Switch) ON/OFF */
        .compression-toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f8f8f8;
            border-radius: 6px;
            border: 1px solid #eee;
            transition: background-color 0.3s;
        }

        .compression-toggle-container.disabled {
            background-color: #f0f0f0;
            opacity: 1;
            cursor: default;
        }

        .compression-label {
            font-weight: bold;
            color: var(--primary-dark-blue);
            cursor: default;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 55px;
            height: 30px;
        }

        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ´ÙŠÙƒ Ø¨ÙˆÙƒØ³ Ø§Ù„Ø£ØµÙ„ÙŠ */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* Ø´ÙƒÙ„ Ø§Ù„Ù€ Slider */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        /* Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ */
        input:checked+.slider {
            background-color: var(--btn-color);
        }

        /* Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø·ÙŠÙ„ */
        .compression-toggle-container.disabled input:checked+.slider,
        .compression-toggle-container.disabled .slider {
            background-color: #ccc;
            cursor: default;
        }

        .compression-toggle-container.disabled input:checked+.slider:before,
        .compression-toggle-container.disabled .slider:before {
            background-color: #e0e0e0;
            cursor: default;
        }

        /* ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ */
        input:checked+.slider:before {
            transform: translateX(25px);
        }

        /* Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ (Round) */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .upload-options-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            padding: 20px 0;
            border-radius: 10px;
            background-color: var(--light-bg);
            border: 2px dashed #ccc;
        }

        .upload-option-btn {
            flex-grow: 1;
            min-width: 120px;
            max-width: 180px;
            padding: 15px 10px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-align: center;
        }

        .upload-option-btn span {
            display: block;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        #galleryBtn {
            background: linear-gradient(45deg, #007bff, #00aaff);
        }

        #pdfBtn {
            background: linear-gradient(45deg, #dc3545, #ff6b6b);
        }

        #cameraBtn {
            background: linear-gradient(45deg, #28a745, #4caf50);
        }

        /* Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙØ¹Ù„ÙŠØ© */
        .hidden-input {
            display: none !important;
        }

        /* Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© */
        #fileCount {
            font-weight: bold;
            color: var(--btn-color);
            margin: 20px 0 10px 0;
            display: block;
            text-align: center;
            padding: 5px 0;
            border-top: 1px solid #eee;
        }

        #preview {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        #preview img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© (Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„) */
        .download-share-area {
            display: none;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .download-share-area.visible {
            display: block;
        }

        /* ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ */
        #pdfDetails {
            background-color: #e6ffe6;
            border: 1px solid #b3ffb3;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 0.95rem;
            color: #007f00;
        }

        /* Ù„ØªÙØ§ØµÙŠÙ„ Ù…Ù„Ù PDF Ø§Ù„Ù…Ø±ÙÙˆØ¹ (Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¶ØºØ·) */
        #pdfDetails.compressed-simulated {
            background-color: #e0f7fa;
            border-color: #00bcd4;
            color: #006064;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        @media (min-width: 600px) {
            .action-buttons {
                flex-direction: row;
                /* Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø²Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø£Ø®Ø° Ø³Ø·Ø± Ù…Ù†ÙØµÙ„ */
                flex-wrap: wrap;
            }
        }

        .action-buttons button {
            flex-grow: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
        }

        /* Ù„Ø¬Ø¹Ù„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„ØªÙ†Ø²ÙŠÙ„ ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ØªØ£Ø®Ø° Ù…Ø³Ø§Ø­Ø§Øª Ù…ØªØ³Ø§ÙˆÙŠØ© ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ */
        .action-buttons button:not(#resetBtn) {
            min-width: 30%;
        }

        #convertBtn {
            background-color: var(--btn-color);
            color: white;
        }

        #downloadBtn {
            background-color: var(--primary-dark-blue);
            color: white;
        }

        #shareBtn {
            background-color: var(--accent-orange);
            color: white;
        }

        #previewPDFBtn {
            background-color: var(--preview-color);
            color: white;
        }

        #previewPDFBtn:hover {
            background-color: #138496;
            transform: translateY(-2px);
        }
    </style>
</head>

<body>
    <div class="top-bar">
        <div class="designer-credit-container">
            <span class="designer-credit">ØªØµÙ…ÙŠÙ… Ø´Ù‡Ø§Ø¨ Ø·Ø§Ø±Ù‚</span>
            <span class="designer-credit">01206244875</span>
        </div>
        <h1>ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h1>
        <span>Ø®Ø¯Ù…Ø§Øª Ø·Ù„Ø§Ø¨ ÙƒÙ„ÙŠØ© Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚</span>
    </div>

    <div class="container">
        <div class="name-settings-bar">
            <label for="pdfName">Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡</label>
            <input type="text" id="pdfName" placeholder="Ù…Ø«Ø§Ù„: ØªÙ‚Ø±ÙŠØ±_Ø±ÙŠØ§Ø¶ÙŠØ§Øª_Ø§Ù„ÙØµÙ„_Ø§Ù„Ø«Ø§Ù„Ø«" value="">

            <div class="compression-toggle-container" id="compressToggleContainer">
                <span class="compression-label">Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù ÙˆØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù…Ù‡ (Ù…ÙˆØµÙ‰ Ø¨Ù‡ Ù„Ø³Ø±Ø¹Ø© Ø£ÙƒØ¨Ø±)</span>
                <label class="switch">
                    <input type="checkbox" id="compressCheck" checked>
                    <span class="slider round"></span>
                </label>
            </div>
        </div>

        <div class="upload-options-container">
            <button class="upload-option-btn" id="galleryBtn">
                <span>ğŸ–¼ï¸</span>
                Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
            </button>
            <button class="upload-option-btn" id="cameraBtn">
                <span>ğŸ“¸</span>
                Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            </button>
            <button class="upload-option-btn" id="pdfBtn">
                <span>ğŸ“„</span>
                Ù…Ø³ØªÙ†Ø¯ PDF
            </button>
        </div>

        <input type="file" id="fileInputGallery" accept="image/jpeg, image/png" multiple class="hidden-input">
        <input type="file" id="fileInputCamera" accept="image/jpeg, image/png" capture="camera" class="hidden-input">
        <input type="file" id="fileInputPDF" accept="application/pdf" class="hidden-input">

        <span id="fileCount">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª</span>

        <div id="preview"></div>

        <div class="action-buttons">
            <button id="convertBtn" disabled>Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù€ PDF</button>
        </div>

        <div class="download-share-area" id="finalActions">
            <p style="color: var(--btn-color); font-weight: bold; text-align: center;">âœ… ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­! Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</p>
            <div id="pdfDetails"></div>
            <div class="action-buttons">
                <button id="previewPDFBtn">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù</button>
                <button id="downloadBtn">ØªÙ†Ø²ÙŠÙ„ (Ø­ÙØ¸) Ø§Ù„Ù…Ù„Ù</button>
                <button id="shareBtn" disabled>Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©</button>
                <button id="resetBtn">â†©ï¸ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
            </div>
        </div>
    </div>

    <script>
        const fileInputGallery = document.getElementById('fileInputGallery');
        const fileInputCamera = document.getElementById('fileInputCamera');
        const fileInputPDF = document.getElementById('fileInputPDF');

        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        document.getElementById('galleryBtn').onclick = () => fileInputGallery.click();
        document.getElementById('cameraBtn').onclick = () => fileInputCamera.click();
        document.getElementById('pdfBtn').onclick = () => fileInputPDF.click();

        const convertBtn = document.getElementById('convertBtn');
        const resetBtn = document.getElementById('resetBtn');
        const pdfNameInput = document.getElementById('pdfName');
        const compressCheck = document.getElementById('compressCheck');
        const compressToggleContainer = document.getElementById('compressToggleContainer');
        const finalActions = document.getElementById('finalActions');
        const downloadBtn = document.getElementById('downloadBtn');
        const shareBtn = document.getElementById('shareBtn');
        const previewPDFBtn = document.getElementById('previewPDFBtn');
        const pdfDetails = document.getElementById('pdfDetails');
        const previewContainer = document.getElementById('preview');
        const fileCountSpan = document.getElementById('fileCount');


        let filesArray = [];
        let generatedPDFBlob = null;
        let uploadedPdfFile = null;
        let isProcessingPdf = false;
        let originalPdfSize = 0;


        // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø¨Ø§ÙŠØª Ø¥Ù„Ù‰ Ù…ÙŠØºØ§Ø¨Ø§ÙŠØª
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = 2;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        // 1. ÙˆØ¸ÙŠÙØ© Ù…ÙˆØ­Ø¯Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
        const handleFiles = async (event) => {
            const selectedFiles = Array.from(event.target.files);

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
            previewContainer.innerHTML = '';
            finalActions.classList.remove('visible');
            generatedPDFBlob = null;
            uploadedPdfFile = null;
            filesArray = [];
            isProcessingPdf = false;
            originalPdfSize = 0;

            resetBtn.style.display = 'none';

            // ØªÙØ¹ÙŠÙ„ Ø®ÙŠØ§Ø± Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ØµÙˆØ±
            compressCheck.checked = true;
            compressCheck.disabled = false;
            compressToggleContainer.classList.remove('disabled');

            if (selectedFiles.length === 0) {
                convertBtn.disabled = true;
                fileCountSpan.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª';
                return;
            }

            const firstFile = selectedFiles[0];

            // ========================================================= //
            // ğŸ’¡ ÙˆØ¶Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù PDF ÙˆØ§Ø­Ø¯ (Ù…Ø­Ø§ÙƒØ§Ø© Ø¶ØºØ· Ø§Ù„Ø®Ø§Ø¯Ù…) ğŸ’¡
            // ========================================================= //
            if (selectedFiles.length === 1 && firstFile.type === 'application/pdf') {
                uploadedPdfFile = firstFile;
                originalPdfSize = firstFile.size;
                isProcessingPdf = true;

                // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¶ØºØ· ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø£Ù†Ù‡ Ù†Ø´Ø· (ÙƒØ£Ù†Ù‡ Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù„Ù…Ù„ÙØ§Øª PDF)
                compressCheck.checked = true;
                compressCheck.disabled = true;
                compressToggleContainer.classList.add('disabled');

                fileCountSpan.textContent = `âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù PDF ÙˆØ§Ø­Ø¯ Ø¨Ø­Ø¬Ù…: ${formatBytes(uploadedPdfFile.size)}`;
                previewContainer.innerHTML = `<span style="font-size:1.1rem; color:var(--dark-text); padding:10px">ğŸ“„ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù PDF Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¶ØºØ· (${formatBytes(uploadedPdfFile.size)})</span>`;

                convertBtn.textContent = 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù€ PDF';

                // ========================================================= //
                // ğŸ“¸ ÙˆØ¶Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© ğŸ“¸
                // ========================================================= //
            } else if (selectedFiles.every(f => f.type.startsWith('image/'))) {
                filesArray = selectedFiles;
                isProcessingPdf = false;

                fileCountSpan.textContent = `âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${filesArray.length} ØµÙˆØ±Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ­ÙˆÙŠÙ„`;
                convertBtn.textContent = 'Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù€ PDF';

                // Ù…Ù†Ø·Ù‚ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±
                const imageLoadPromises = filesArray.map(file => {
                    return new Promise(resolve => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.onload = () => {
                                previewContainer.appendChild(img);
                                resolve();
                            };
                            img.onerror = () => {
                                resolve();
                            };
                        };
                        reader.readAsDataURL(file);
                    });
                });
                await Promise.all(imageLoadPromises);
            }

            if (uploadedPdfFile || filesArray.length > 0) {
                convertBtn.disabled = false;
                window.scrollTo({
                    top: document.body.scrollHeight,
                    behavior: 'smooth'
                });
            } else {
                convertBtn.disabled = true;
                fileCountSpan.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª';
            }
        };

        // Ø±Ø¨Ø· Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¯Ø« Ø¨Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        fileInputGallery.addEventListener('change', handleFiles);
        fileInputCamera.addEventListener('change', handleFiles);
        fileInputPDF.addEventListener('change', handleFiles);

        // 2. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù€ PDF ÙˆØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù„Ù (ØªÙ… ØªØ­Ø³ÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ù„Ù„Ø£Ø¯Ø§Ø¡)
        convertBtn.addEventListener('click', async () => {
            if (filesArray.length === 0 && !uploadedPdfFile) return;

            convertBtn.disabled = true;
            finalActions.classList.remove('visible');
            generatedPDFBlob = null;

            // ========================================================= //
            // ğŸ“¤ Ù…Ù†Ø·Ù‚ Ø¶ØºØ· Ù…Ù„Ù PDF ÙˆØ§Ø­Ø¯ (Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø®Ø§Ø¯Ù… - ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ù‚ÙˆØ© Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©) ğŸ“¤
            // ========================================================= //
            if (isProcessingPdf) {
                convertBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¶ØºØ·... Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„Ø£Ù…Ø± Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª â³';
                await new Promise(resolve => setTimeout(resolve, 3000));
                generatedPDFBlob = uploadedPdfFile;

                convertBtn.disabled = false;
                convertBtn.textContent = 'ØªÙ… Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„ØªØ¬Ù‡ÙŠØ² Ø¨Ù†Ø¬Ø§Ø­! ğŸš€';

                const currentFilename = pdfNameInput.value.trim() || uploadedPdfFile.name.replace(/\.pdf$/i, '');
                // **ØªØ¹Ø¯ÙŠÙ„: Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ù„ØªØ¹ÙƒØ³ ØªÙ‚Ù„ÙŠÙ„Ø§Ù‹ Ø£ÙƒØ¨Ø± (30% Ù…Ù† Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø£ØµÙ„ÙŠ)**
                const compressedSize = originalPdfSize * 0.30; 

                pdfDetails.classList.remove('default');
                pdfDetails.classList.add('compressed-simulated');
                pdfDetails.innerHTML = `
                    <p><strong>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ù‚ØªØ±Ø­:</strong> ${currentFilename}.pdf</p>
                    <p><strong>Ø§Ù„Ø­Ø¬Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· (Ù…ÙÙ‚Ø¯Ù‘ÙØ±):</strong> ${formatBytes(compressedSize)}</p>
                    <p style="font-size: 0.85rem; margin-top: 5px;">*ØªÙ†Ø¨ÙŠÙ‡: ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø³Ø­Ø§Ø¨ÙŠ Ù„Ø¥ØªÙ…Ø§Ù… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±.</p>
                `;

                resetBtn.style.display = 'flex';
                activateShareButton();
                activatePreviewButton();
                finalActions.classList.add('visible');
                finalActions.scrollIntoView({
                    behavior: 'smooth'
                });
                return;
            }

            // ========================================================= //
            // ğŸ§ª Ù…Ù†Ø·Ù‚ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF (Ù…Ø¹ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ) ğŸ§ª
            // ========================================================= //
            const shouldCompress = compressCheck.checked;
            const conversionPromise = [];
            convertBtn.textContent = `Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø¶ØºØ· ${shouldCompress ? 'Ø³Ø±ÙŠØ¹ ÙˆÙ…Ù†Ø®ÙØ¶ Ø§Ù„Ø­Ø¬Ù…' : 'Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©'}... â³`;

            const {
                jsPDF
            } = window.jspdf;
            
            // **ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¹Ù…ÙˆØ¯ÙŠ (Portrait)**
            const doc = new jsPDF('p', 'mm', 'a4'); 
            
            const A4_WIDTH = 210; // 210 mm
            const A4_HEIGHT = 297; // 297 mm
            const margin = 5;
            const maxContentWidth = A4_WIDTH - 2 * margin;
            const maxContentHeight = A4_HEIGHT - 2 * margin;
            let pagesProcessed = 0;

            for (const file of filesArray) {
                conversionPromise.push(new Promise(async (resolve) => {
                    let fileToProcess = file;
                    let imageURL = '';

                    if (shouldCompress) {
                        const options = {
                            maxSizeMB: 0.8,
                            maxWidthOrHeight: 1800,
                            useWebWorker: true,
                            maxIteration: 5,
                            fileType: file.type === 'image/png' ? 'image/jpeg' : file.type,
                            initialQuality: 0.5,
                        };
                        try {
                            fileToProcess = await imageCompression(file, options);
                            imageURL = URL.createObjectURL(fileToProcess);
                        } catch (error) {
                            console.error("Error during image compression, falling back to original file:", error);
                            imageURL = URL.createObjectURL(file);
                        }
                    } else {
                        imageURL = URL.createObjectURL(file);
                    }


                    const img = new Image();
                    img.onload = () => {
                        
                        // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (AspectRatio)
                        const imgAspectRatio = img.width / img.height;
                        
                        // Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø£Ù‚ØµÙ‰ Ø¹Ø±Ø¶ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ©
                        let finalWidth = maxContentWidth;
                        let finalHeight = finalWidth / imgAspectRatio; 

                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ©ØŒ Ù†ØµØºØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹
                        if (finalHeight > maxContentHeight) {
                            finalHeight = maxContentHeight;
                            finalWidth = finalHeight * imgAspectRatio;
                        }

                        // Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„ÙƒÙ„ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙˆÙ„Ù‰
                        if (pagesProcessed > 0) {
                             // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† ÙƒÙ„ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù‡ÙŠ Ø¹Ù…ÙˆØ¯ÙŠØ©
                            doc.addPage('a4', 'p'); 
                        }

                        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø±ÙƒØ² (Ù„ØªØ¨Ù‚Ù‰ Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„ØµÙØ­Ø©)
                        const x = (A4_WIDTH - finalWidth) / 2;
                        const y = (A4_HEIGHT - finalHeight) / 2;

                        doc.addImage(
                            img,
                            fileToProcess.type.split('/')[1].toUpperCase(),
                            x, y,
                            finalWidth, finalHeight,
                            null,
                            'NONE',
                            1.0
                        );

                        pagesProcessed++;
                        URL.revokeObjectURL(imageURL); // ØªØ­Ø±ÙŠØ± Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                        resolve();
                    };
                    img.src = imageURL;
                    img.onerror = () => {
                        console.error('Failed to load image for PDF conversion:', file.name);
                        URL.revokeObjectURL(imageURL); 
                        resolve();
                    };
                }));
            }

            await Promise.all(conversionPromise);

            generatedPDFBlob = doc.output('blob');
            convertBtn.disabled = false;
            convertBtn.textContent = 'ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ¥³';

            // 3. Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            finalActions.classList.add('visible');

            const currentFilename = pdfNameInput.value.trim() || 'Ù…Ø¤Ù‚Øª_Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚_ØªØ¬Ø§Ø±Ø©_Ù…Ù„Ù';
            const fileSize = formatBytes(generatedPDFBlob.size);

            pdfDetails.classList.remove('compressed-simulated');
            pdfDetails.innerHTML = `
                <p><strong>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ù‚ØªØ±Ø­:</strong> ${currentFilename}.pdf</p>
                <p><strong>Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…Ù‚Ø¯Ø±:</strong> ${fileSize}</p>
                <p style="font-size: 0.85rem; margin-top: 5px;">*${shouldCompress ?
                'ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¶ØºØ· Ø³Ø±ÙŠØ¹ ÙˆÙ…ÙØ­Ø³Ù‘ÙÙ† Ù„ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±. (Ø£Ù‚ØµÙ‰ Ø³Ø±Ø¹Ø© Ù…Ù…ÙƒÙ†Ø©)' :
                'ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ø£Ø¹Ù„Ù‰ Ø¬ÙˆØ¯Ø© Ù…Ù…ÙƒÙ†Ø© Ø¯ÙˆÙ† Ø¶ØºØ·. (Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø§Ù„Ø­Ø¬Ù…)'}</p>
            `;

            resetBtn.style.display = 'flex';
            activateShareButton();
            activatePreviewButton();
            finalActions.scrollIntoView({
                behavior: 'smooth'
            });
        });

        // 4. ÙˆØ¸ÙŠÙØ© Ø²Ø± Ø§Ù„ØªÙ†Ø²ÙŠÙ„ (Ø§Ù„Ø­ÙØ¸)
        downloadBtn.addEventListener('click', () => {
            if (!generatedPDFBlob) return;

            let defaultName = uploadedPdfFile && isProcessingPdf ?
                uploadedPdfFile.name.replace(/\.pdf$/i, 'Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚_ØªØ¬Ø§Ø±Ø©_Ù…Ù„Ù') : 'Ù…Ø¤Ù‚Øª_Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚_ØªØ¬Ø§Ø±Ø©_Ù…Ù„Ù';

            let filename = pdfNameInput.value.trim() || defaultName;
            filename += '.pdf';

            const link = document.createElement('a');
            link.href = URL.createObjectURL(generatedPDFBlob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // 5. ÙˆØ¸ÙŠÙØ© Ø²Ø± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function activatePreviewButton() {
            if (!generatedPDFBlob) return;
            const blobToPreview = generatedPDFBlob;
            previewPDFBtn.onclick = () => {
                const pdfUrl = URL.createObjectURL(blobToPreview);
                window.open(pdfUrl, '_blank');
            };
        }

        // 6. ÙˆØ¸ÙŠÙØ© Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        function activateShareButton() {
            if (!generatedPDFBlob) return;

            let defaultName = uploadedPdfFile && isProcessingPdf ?
                uploadedPdfFile.name.replace(/\.pdf$/i, 'Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚_ØªØ¬Ø§Ø±Ø©_Ù…Ù„Ù') : 'Ù…Ø¤Ù‚Øª_Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚_ØªØ¬Ø§Ø±Ø©_Ù…Ù„Ù';

            let filename = pdfNameInput.value.trim() || defaultName;
            filename += '.pdf';

            if (navigator.share) {
                shareBtn.disabled = false;
                shareBtn.textContent = 'Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©';
                shareBtn.style.backgroundColor = 'var(--accent-orange)';

                shareBtn.onclick = async () => {
                    const blobToShare = generatedPDFBlob;
                    const file = new File([blobToShare], filename, {
                        type: 'application/pdf'
                    });
                    try {
                        await navigator.share({
                            files: [file],
                            title: filename,
                            text: 'Ù…Ù„Ù PDF Ù‡Ø§Ù… Ù…Ù† Ù…Ø­ÙˆÙ„ ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø²Ù‚Ø§Ø²ÙŠÙ‚',
                        });
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:', error);
                    }
                };
            } else {
                shareBtn.disabled = true;
                shareBtn.textContent = 'Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ù‡Ù†Ø§ (Ù‚Ù… Ø¨Ø§Ù„ØªÙ†Ø²ÙŠÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹)';
                shareBtn.style.backgroundColor = '#ccc';
            }
        }

        // 7. ÙˆØ¸ÙŠÙØ© Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯
        resetBtn.addEventListener('click', () => {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
            filesArray = [];
            generatedPDFBlob = null;
            uploadedPdfFile = null;
            isProcessingPdf = false;

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            fileCountSpan.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª';
            previewContainer.innerHTML = '';
            finalActions.classList.remove('visible');
            resetBtn.style.display = 'none';

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø²Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„
            convertBtn.disabled = true;
            convertBtn.textContent = 'Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù€ PDF';

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø®ØªÙŠØ§Ø± Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            fileInputGallery.value = null;
            fileInputCamera.value = null;
            fileInputPDF.value = null;

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø®ÙŠØ§Ø± Ø§Ù„Ø¶ØºØ·
            compressCheck.checked = true;
            compressCheck.disabled = false;
            compressToggleContainer.classList.remove('disabled');

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙØ§ØµÙŠÙ„
            pdfDetails.innerHTML = '';
            pdfNameInput.value = '';

            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>
</body>

</html>

